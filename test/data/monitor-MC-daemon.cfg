process ECALDQM = {

#     module ecalUncalibHit = ecalFixedAlphaBetaFitUncalibRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalFixedAlphaBetaFitUncalibRecHit.cfi"

#     replace ecalUncalibHit.MinAmplBarrel = 12.
#     replace ecalUncalibHit.MinAmplEndcap = 16.

     module ecalUncalibHit = ecalWeightUncalibRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalWeightUncalibRecHit.cfi"

     replace ecalUncalibHit.EBdigiCollection = ecalDigis:ebDigis
     replace ecalUncalibHit.EEdigiCollection = ecalDigis:eeDigis

include "RecoLocalCalo/EcalRecProducers/data/ecalRecHit.cfi"

     replace ecalRecHit.EBuncalibRecHitCollection = ecalUncalibHit:EcalUncalibRecHitsEB
     replace ecalRecHit.EEuncalibRecHitCollection = ecalUncalibHit:EcalUncalibRecHitsEE

include "DQM/EcalBarrelMonitorModule/data/EcalBarrelMonitorModule.cfi"

     replace ecalBarrelMonitorModule.EBDigiCollection = ecalDigis:ebDigis

     replace ecalBarrelMonitorModule.enableMonitorDaemon = true
     replace ecalBarrelMonitorModule.runType = 3 # MTCC/PHYSICS

include "DQM/EcalBarrelMonitorTasks/data/EcalBarrelMonitorTasks.cfi"

     replace ecalBarrelMonitorModule.EcalTrigPrimDigiCollection = ecalTriggerPrimitiveDigis

     replace ecalBarrelOccupancyTask.EBDigiCollection = ecalDigis:ebDigis
     replace ecalBarrelOccupancyTask.EcalTrigPrimDigiCollection = ecalTriggerPrimitiveDigis
     replace ecalBarrelPedestalOnlineTask.EBDigiCollection = ecalDigis:ebDigis

include "DQM/EcalBarrelMonitorClient/data/EcalBarrelMonitorClient.cfi"

     replace ecalBarrelMonitorClient.maskFile = "maskfile-EB.dat"
     replace ecalBarrelMonitorClient.mergeRuns = true
     replace ecalBarrelMonitorClient.location = "H4"
     replace ecalBarrelMonitorClient.baseHtmlDir = "."
     replace ecalBarrelMonitorClient.enabledClients = { "Integrity",
                                                        "Occupancy",
                                                        "PedestalOnline",
                                                        "Timing",
                                                        "Cluster" }

     module preScaler = Prescaler{ int32 prescaleFactor = 1 }

     module dqmInfoEB = DQMEventInfo{
       untracked string subSystemFolder = "EcalBarrel"
     }

     module dqmQTestEB = QualityTester{
       untracked int32 prescaleFactor = 1
       untracked bool getQualityTestsFromFile = true
       untracked string qtList = "EcalBarrelQualityTests.xml"
       untracked string reportThreshold = "red"
     }

     module dqmSaverEB = DQMFileSaver{
       untracked string dirName = "."
       untracked string fileName = "EcalBarrel"
     }

include "RecoEcal/EgammaClusterProducers/data/ecalClusteringSequence.cff"

     sequence ecalBarrelDataSequence = { preScaler,
                                         ecalUncalibHit,
                                         ecalRecHit, 
                                         islandBasicClusters,
                                         islandSuperClusters,
                                         hybridSuperClusters }

     sequence ecalBarrelMonitorSequence = { ecalBarrelMonitorModule,
                                            dqmInfoEB,
                                            ecalBarrelMonitorClient,
                                            dqmQTestEB, 
                                            dqmSaverEB }

     path p = { ecalBarrelDataSequence, ecalBarrelMonitorSequence }

     endpath q = { ecalBarrelDefaultTasksSequence, ecalBarrelClusterTask }

#     service = LockService{ }

#     untracked PSet maxEvents = {untracked int32 input = 150}
#     untracked PSet maxEvents = {untracked int32 input = 300}
     source = PoolSource {
#---
#       untracked vstring fileNames = { 'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root' }
       untracked vstring fileNames = { 'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root',
                                       'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root',
                                       'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root',
                                       'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root',
                                       'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root',
                                       'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root',
                                       'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root',
                                       'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root',
                                       'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root',
                                       'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root',
                                       'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root',
                                       'file:/tmp/5E883D60-4B98-DC11-BD17-000423D6A6F4.root' }
#---
     }

     es_source = EcalTrivialConditionRetriever{
       untracked double adcToGeVEBConstant = 0.035
       untracked double adcToGeVEEConstant = 0.060
       untracked vdouble amplWeights = { -0.333, -0.333, -0.333,
                                          0.000,  0.000,  1.000,
                                          0.000,  0.000,  0.000,  0.000 }
       untracked vdouble pedWeights  = {  0.333,  0.333,  0.333,
                                          0.000,  0.000,  0.000,
                                          0.000,  0.000,  0.000,  0.000 }
       untracked vdouble jittWeights = {  0.041,  0.041,  0.041,
                                          0.000,  1.325, -0.050,
                                         -0.504, -0.502, -0.390,  0.000 }
     }

include "CalibCalorimetry/EcalLaserCorrection/data/ecalLaserCorrectionService.cfi"

     service = MessageLogger{
       untracked vstring destinations = { "cout" }
       untracked vstring categories = { "EcalBarrelMonitor" }
       untracked PSet cout = {
         untracked string threshold = "WARNING"
         untracked PSet default                        = { untracked int32 limit = 0 }
         untracked PSet EcalBarrelMonitor              = { untracked int32 limit = 0 }
         untracked bool noTimeStamps = true
         untracked bool noLineBreaks = true
       }
     }

     service = DaqMonitorROOTBackEnd{
       untracked int32 verbose = 0
     }

     service = DQMShipMonitoring{
       untracked uint32 period = 5
     }

include "DQMServices/Examples/test/dqm_monitorDaemon.cfi"

     replace MonitorDaemon.UpdateDelay = 500
     replace MonitorDaemon.maxAttempts2Reconnect = 99999
     replace MonitorDaemon.NameAsSource = "EB"

}
