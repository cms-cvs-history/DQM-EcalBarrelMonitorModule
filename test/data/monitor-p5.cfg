process ECALDQM = { 

include "EventFilter/EcalRawToDigiDev/data/EcalUnpackerMapping.cfi"
include "EventFilter/EcalRawToDigiDev/data/EcalUnpackerData.cfi"

# GREA
     replace ecalEBunpacker.FEDs = {643}
     replace ecalEBunpacker.orderedFedList = {643}
     replace ecalEBunpacker.orderedDCCIdList = {41}

     module ecalUncalibHit2 = ecalFixedAlphaBetaFitUncalibRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalFixedAlphaBetaFitUncalibRecHit.cfi"

     replace ecalUncalibHit2.MinAmplBarrel = 12.
     replace ecalUncalibHit2.MinAmplEndcap = 16.

     replace ecalUncalibHit2.EBdigiCollection = ecalEBunpacker:ebDigis
     replace ecalUncalibHit2.EEdigiCollection = ecalEBunpacker:eeDigis

     module ecalUncalibHit = ecalWeightUncalibRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalWeightUncalibRecHit.cfi"

     replace ecalUncalibHit.EBdigiCollection = ecalEBunpacker:ebDigis
     replace ecalUncalibHit.EEdigiCollection = ecalEBunpacker:eeDigis

include "RecoLocalCalo/EcalRecProducers/data/ecalRecHit.cfi"

     replace ecalRecHit.EBuncalibRecHitCollection = ecalUncalibHit2:EcalUncalibRecHitsEB
     replace ecalRecHit.EEuncalibRecHitCollection = ecalUncalibHit2:EcalUncalibRecHitsEE

include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"
include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"

include "Geometry/EcalMapping/data/EcalMapping.cfi"
include "Geometry/EcalMapping/data/EcalMappingRecord.cfi"

include "DQM/EcalBarrelMonitorModule/data/EcalBarrelMonitorModule.cfi"

include "DQM/EcalBarrelMonitorTasks/data/EcalBarrelMonitorTasks.cfi"

     replace ecalBarrelCosmicTask.EcalUncalibratedRecHitCollection = ecalUncalibHit2:EcalUncalibRecHitsEB
     replace ecalBarrelLaserTask.EcalUncalibratedRecHitCollection = ecalUncalibHit2:EcalUncalibRecHitsEB
     replace ecalBarrelTimingTask.EcalUncalibratedRecHitCollection = ecalUncalibHit2:EcalUncalibRecHitsEB

include "DQM/EcalBarrelMonitorClient/data/EcalBarrelMonitorClient.cfi"

     replace ecalBarrelMonitorClient.maskFile = "maskfile-EB.dat"
     replace ecalBarrelMonitorClient.location = "P5"
     replace ecalBarrelMonitorClient.baseHtmlDir = "."

# GREA
     replace ecalBarrelMonitorClient.superModules = { 32 }

     module preScaler = Prescaler{ int32 prescaleFactor = 1 }

     module dqmInfoEB = DQMEventInfo{
       untracked string subSystemFolder = "EcalBarrel"
     }

     module dqmQTestEB = QualityTester{
       untracked int32 prescaleFactor = 1
       untracked bool getQualityTestsFromFile = true
       untracked FileInPath qtList = "DQM/EcalBarrelMonitorModule/test/data/EcalBarrelQualityTests.xml"
       untracked string reportThreshold = "red"
     }

     module dqmSaverEB = DQMFileSaver{
       untracked string convention = "Online"
       untracked string dirName = "."
       untracked string fileName = "EcalBarrel"
     }

     sequence ecalDataSequence = { preScaler,
                                   ecalEBunpacker,
                                   ecalUncalibHit,
                                   ecalUncalibHit2,
                                   ecalRecHit }

     sequence ecalBarrelMonitorSequence = { ecalBarrelMonitorModule,
                                            dqmInfoEB,
                                            ecalBarrelMonitorClient,
                                            dqmQTestEB,
                                            dqmSaverEB }

     path p = { ecalDataSequence, ecalBarrelMonitorSequence }

     endpath q = { ecalBarrelCosmicTasksSequence }

#     untracked PSet maxEvents = {untracked int32 input = 150}

#     source = NewEventStreamFileReader{
#       untracked vstring fileNames = {
#         '/store/users/dellaric/data/GlobalAug07.00017123.0001.A.storageManager.0.0000.dat',
#         '/store/users/dellaric/data/GlobalAug07.00017123.0002.A.storageManager.0.0000.dat'
#       }
#     }

     source = PoolSource{
       untracked vstring fileNames = { '/store/users/dellaric/data/GlobalAug07.00017123.root' }
     }

     es_source = EcalTrivialConditionRetriever{
       untracked double adcToGeVEBConstant = 0.00875 # 0.035
       untracked vdouble amplWeights =        { -0.333, -0.333, -0.333,
                                                 0.000,  0.000,  1.000,
                                                 0.000,  0.000,  0.000,  0.000 }
       untracked vdouble amplWeightsAftGain = {  0.000,  0.000,  0.000,
                                                 0.000,  0.000,  1.000,
                                                 0.000,  0.000,  0.000,  0.000 }
       untracked vdouble pedWeights  =        {  0.333,  0.333,  0.333,
                                                 0.000,  0.000,  0.000,
                                                 0.000,  0.000,  0.000,  0.000 }
       untracked vdouble pedWeightsAft =      {  0.000,  0.000,  0.000,
                                                 0.000,  0.000,  0.000,
                                                 0.000,  0.000,  0.000,  0.000 }
       untracked vdouble jittWeights =        {  0.041,  0.041,  0.041,
                                                 0.000,  1.325, -0.050,
                                                -0.504, -0.502, -0.390,  0.000 }
       untracked vdouble jittWeightsAft =     {  0.000,  0.000,  0.000,
                                                 0.000,  1.098, -0.046,
                                                -0.416, -0.419, -0.337,  0.000 }
     }

include "CalibCalorimetry/EcalLaserCorrection/data/ecalLaserCorrectionService.cfi"

     service = MessageLogger{
       untracked vstring destinations = { "cout" }
       untracked vstring categories = { "EcalTBInputService",
                                        "EcalTBRawToDigi",
                                        "EcalTBRawToDigiTriggerType",
                                        "EcalTBRawToDigiTpg",
                                        "EcalTBRawToDigiNumTowerBlocks",
                                        "EcalTBRawToDigiTowerId",
                                        "EcalTBRawToDigiTowerSize",
                                        "EcalTBRawToDigiChId",
                                        "EcalTBRawToDigiGainZero",
                                        "EcalTBRawToDigiGainSwitch",
                                        "EcalTBRawToDigiDccBlockSize",
                                        "EcalRawToDigiDev",
                                        "EcalRawToDigiDevTriggerType",
                                        "EcalRawToDigiDevTpg",
                                        "EcalRawToDigiDevNumTowerBlocks",
                                        "EcalRawToDigiDevTowerId",
                                        "EcalRawToDigiDevTowerSize",
                                        "EcalRawToDigiDevChId",
                                        "EcalRawToDigiDevGainZero",
                                        "EcalRawToDigiDevGainSwitch",
                                        "EcalRawToDigiDevDccBlockSize",
                                        "EcalRawToDigiDevMemBlock",
                                        "EcalRawToDigiDevMemTowerId",
                                        "EcalRawToDigiDevMemChId",
                                        "EcalRawToDigiDevMemGain",
                                        "EcalRawToDigiDevTCC",
                                        "EcalRawToDigiDevSRP",
                                        "EcalDCCHeaderRuntypeDecoder",
                                        "EcalBarrelMonitorModule"
                                      }
       untracked PSet cout = {
         untracked string threshold = "WARNING"
         untracked PSet default                        = { untracked int32 limit = 0 }
         untracked PSet EcalTBInputService             = { untracked int32 limit = 0 }
         untracked PSet EcalTBRawToDigi                = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiTriggerType     = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiTpg             = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiNumTowerBlocks  = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiTowerId         = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiTowerSize       = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiChId            = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiGainZero        = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiGainSwitch      = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiDccBlockSize    = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDev               = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevTriggerType    = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevTpg            = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevNumTowerBlocks = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevTowerId        = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevTowerSize      = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevChId           = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevGainZero       = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevGainSwitch     = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevDccBlockSize   = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevMemBlock       = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevMemTowerId     = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevMemChId        = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevMemGain        = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevTCC            = { untracked int32 limit = 1000 }
         untracked PSet EcalRawToDigiDevSRP            = { untracked int32 limit = 1000 }
         untracked PSet EcalDCCHeaderRuntypeDecoder    = { untracked int32 limit = 1000 }
         untracked PSet EcalBarrelMonitorModule        = { untracked int32 limit = 0 }
         untracked bool noTimeStamps = true
         untracked bool noLineBreaks = true
       }
     }

include "DQMServices/Core/data/DQM.cfg"

     replace DQM.collectorHost = ""

}
