process ECALDQM = { 

     module ecalEBunpacker = EcalDCCUnpackingModule{ }

include "RecoTBCalo/EcalTBHodoscopeReconstructor/data/ecal2006TBHodoscopeReconstructor.cfi"

     replace ecal2006TBHodoscopeReconstructor.rawInfoProducer = "ecalEBunpacker"

include "RecoTBCalo/EcalTBTDCReconstructor/data/ecal2006TBTDCReconstructor.cfi"

     replace ecal2006TBTDCReconstructor.rawInfoProducer = "ecalEBunpacker"
     replace ecal2006TBTDCReconstructor.eventHeaderProducer = "ecalEBunpacker"

     module ecalUncalibHit = ecalFixedAlphaBetaFitUncalibRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalFixedAlphaBetaFitUncalibRecHit.cfi"

     replace ecalUncalibHit.EBdigiCollection = ecalEBunpacker:
     replace ecalUncalibHit.EEdigiCollection = ecalEBunpacker:

#     module ecalUncalibHit = ecal2006TBWeightUncalibRecHit from "RecoTBCalo/EcalTBRecProducers/data/ecal2006TBWeightUncalibRecHit.cfi"
#
#     replace ecal2006TBWeightUncalibRecHit.digiProducer = "ecalEBunpacker"

include "RecoLocalCalo/EcalRecProducers/data/ecalRecHit.cfi"

     replace ecalRecHit.EBuncalibRecHitCollection = ecalUncalibHit:EcalUncalibRecHitsEB
     replace ecalRecHit.EEuncalibRecHitCollection = ecalUncalibHit:EcalUncalibRecHitsEE

include "DQM/EcalBarrelMonitorModule/data/EcalBarrelMonitorModule.cfi"

     replace ecalBarrelMonitorModule.enableMonitorDaemon = false

include "DQM/EcalBarrelMonitorTasks/data/EcalBarrelMonitorTasks.cfi"

include "DQM/EcalBarrelMonitorTasks/data/disableCleanup.cff"

include  "SimCalorimetry/EcalTrigPrimProducers/data/ecalTriggerPrimitiveDigis_barrelOnly.cff"

    replace ecalTriggerPrimitiveDigis.Label = "ecalEBunpacker"
    replace ecalTriggerPrimitiveDigis.InstanceEB = ""    
    
include "DQM/EcalBarrelMonitorClient/data/EcalBarrelMonitorClient.cfi"

     replace ecalBarrelMonitorClient.location = "H4B"
     replace ecalBarrelMonitorClient.baseHtmlDir = "."
     replace ecalBarrelMonitorClient.enableTCC = true
     replace ecalBarrelMonitorClient.enableMonitorDaemon = false
     replace ecalBarrelMonitorClient.prefixME = ""
     replace ecalBarrelMonitorClient.enableServer = false
     replace ecalBarrelMonitorClient.superModules = { 19 }

     module preScaler = Prescaler{ int32 prescaleFactor = 1 }

     sequence ecalBarrelDataSequence = { preScaler,
                                         ecalEBunpacker,
                                         ecal2006TBHodoscopeReconstructor,
                                         ecal2006TBTDCReconstructor,
                                         ecalUncalibHit,
                                         ecalRecHit }

     sequence ecalBarrelMonitorSequence = { ecalBarrelMonitorModule,
                                            ecalBarrelMonitorClient }

     path p = { ecalBarrelDataSequence, ecalBarrelMonitorSequence }

#     endpath q = { ecalBarrelTestBeamTasksSequence }
     endpath q = { ecalBarrelTestBeamTasksSequence, ecalTriggerPrimitiveDigis }

#     service = LockService{ }
 
     source = PoolSource{
       untracked int32 maxEvents = 150
#---
# replace /tmp with the path to your file
       untracked vstring fileNames = { 'rfio:/castor/cern.ch/cms/archive/ecal/h4tb.pool-SM12/h4b.00015071.A.0.0.root'}
       untracked uint32 debugVebosity = 10
       untracked bool   debugFlag     = true
     }

     es_source src1 = EcalTrivialConditionRetriever{
       untracked bool producedEcalWeights = false
     }

     service = MessageLogger{
       untracked vstring destinations = { "cout" }
       untracked vstring categories = { "EcalTBInputService",
                                        "EcalTBRawToDigi",
                                        "EcalTBRawToDigiTriggerType",
                                        "EcalTBRawToDigiTpg",
                                        "EcalTBRawToDigiNumTowerBlocks",
                                        "EcalTBRawToDigiTowerId",
                                        "EcalTBRawToDigiTowerSize",
                                        "EcalTBRawToDigiChId",
                                        "EcalTBRawToDigiGainZero",
                                        "EcalTBRawToDigiGainSwitch",
                                        "EcalTBRawToDigiDccBlockSize",
                                        "EcalBarrelMonitor"
                                      }
       untracked PSet cout = {
         untracked string threshold = "WARNING"
         untracked PSet default                       = { untracked int32 limit = 0 }
         untracked PSet EcalTBInputService            = { untracked int32 limit = 0 }
         untracked PSet EcalTBRawToDigi               = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiTriggerType    = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiTpg            = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiNumTowerBlocks = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiTowerId        = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiTowerSize      = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiChId           = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiGainZero       = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiGainSwitch     = { untracked int32 limit = 1000 }
         untracked PSet EcalTBRawToDigiDccBlockSize   = { untracked int32 limit = 1000 }
         untracked PSet EcalBarrelMonitor             = { untracked int32 limit = 0 }
         untracked bool noTimeStamps = true
         untracked bool noLineBreaks = true
       }
     }

     service = DaqMonitorROOTBackEnd{ }

}
